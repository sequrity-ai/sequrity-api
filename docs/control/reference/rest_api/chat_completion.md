# Sequrity Control Chat Completion API

The Sequrity Control API provides a chat completion endpoint that is mostly compatible with the [OpenAI Chat Completions API](https://platform.openai.com/docs/api-reference/chat). This allows you to use Sequrity's security features while maintaining compatibility with existing OpenAI-based applications.


## Request

### Endpoint

Sequrity Control Chat Completion API can be accessed via the following endpoints:

- Openrouter as service provider:
    ```
    POST https://api.sequrity.ai/control/v1/chat/completions
    ```
- Specific service provider
    ```
    POST https://api.sequrity.ai/control/{service_provider}/v1/chat/completions
    ```

    See [Service Providers](../../../general/rest_api/service_provider.md) for available service providers.

### Request Body Schema

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `messages` | `array[Message]` | Yes | A list of messages comprising the conversation so far. See [Message Types](#message-types) below. |
| `model` | `string` | Yes | Model ID used to generate the response, like `openai/gpt-5-mini`. For Dual-LLM, two models can be specified separated by a comma, like `openai/gpt-5-mini,openai/gpt-5-nano`, for PLLM and QLLM |
| `reasoning_effort` | `string` | No | Constrains effort on reasoning for reasoning models. Supported values: `minimal`, `low`, `medium`, `high`. |
| `response_format` | `object` | No | An object specifying the format that the model must output. Setting to `json_schema` enables Structured Outputs. See [Response Format](#response-format). |
| `seed` | `integer` | No | If specified, the system will make a best effort to sample deterministically for reproducible results. |
| `stream` | `boolean` | No | If set to `true`, partial message deltas will be sent as server-sent events. |
| `temperature` | `float` | No | Sampling temperature to use, between 0 and 2. Higher values make output more random. |
| `tools` | `array[Tool]` | No | A list of tools the model may call. Currently, only functions are supported as a tool. See [Tools](#tools). |
| `top_p` | `float` | No | An alternative to sampling with temperature, called nucleus sampling. Use 0.1 for top 10% probability mass. |

### Message Types

Messages can be one of the following types, distinguished by the `role` field:

#### System Message

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `role` | `"system"` | Yes | The role of the message author. |
| `content` | `string` or `array[ContentPartText]` | Yes | The contents of the system message. |
| `name` | `string` | No | An optional name for the participant to differentiate between participants of the same role. |

#### Developer Message

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `role` | `"developer"` | Yes | The role of the message author. |
| `content` | `string` or `array[ContentPartText]` | Yes | The contents of the developer message. |
| `name` | `string` | No | An optional name for the participant. |

#### User Message

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `role` | `"user"` | Yes | The role of the message author. |
| `content` | `string` or `array[ContentPart]` | Yes | The contents of the user message. Supports text, images, audio, and files. |
| `name` | `string` | No | An optional name for the participant. |

#### Assistant Message

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `role` | `"assistant"` | Yes | The role of the message author. |
| `content` | `string` or `array[ContentPartText \| ContentPartRefusal]` | No | The contents of the assistant message. Required unless `tool_calls` is specified. |
| `name` | `string` | No | An optional name for the participant. |
| `refusal` | `string` | No | The refusal message by the assistant. |
| `audio` | `object` | No | Data about a previous audio response from the model. |
| `tool_calls` | `array[ToolCall]` | No | The tool calls generated by the model, such as function calls. |
| `function_call` | `object` | No | **Deprecated.** Replaced by `tool_calls`. |

#### Tool Message

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `role` | `"tool"` | Yes | The role of the message author. |
| `content` | `string` or `array[ContentPartText]` | Yes | The contents of the tool message. |
| `tool_call_id` | `string` | Yes | Tool call that this message is responding to. |

### Content Parts

User messages support multimodal content through content parts:

| Type | Fields | Description |
|------|--------|-------------|
| `text` | `type`, `text` | Plain text content. |
| `image_url` | `type`, `image_url.url`, `image_url.detail` | Image content via URL or base64. Detail can be `auto`, `low`, or `high`. |
| `input_audio` | `type`, `input_audio.data`, `input_audio.format` | Audio content as base64. Format can be `wav` or `mp3`. |
| `file` | `type`, `file.file_data`, `file.file_id`, `file.filename` | File content via base64 data or file ID. |

### Tools

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `type` | `"function"` | Yes | The type of the tool. Currently, only `function` is supported. |
| `function.name` | `string` | Yes | The name of the function. Must be a-z, A-Z, 0-9, underscores, or dashes (max 64 characters). |
| `function.description` | `string` | No | A description of what the function does. |
| `function.parameters` | `object` | No | The parameters the function accepts, described as a JSON Schema object. |
| `function.strict` | `boolean` | No | Whether to enable strict schema adherence when generating the function call. |

### Response Format

| Type | Description |
|------|-------------|
| `text` | Default text response format. |
| `json_object` | Enables JSON mode. The model will output valid JSON. |
| `json_schema` | Enables Structured Outputs with a specific JSON Schema. Includes `name`, `description`, `schema`, and `strict` fields. |

## Response

### Response Body Schema

| Field | Type | Description |
|-------|------|-------------|
| `id` | `string` | A unique identifier for the chat completion. |
| `object` | `"chat.completion"` | The object type, always `chat.completion`. |
| `created` | `integer` | The Unix timestamp (in seconds) of when the chat completion was created. |
| `model` | `string` | The model used for the chat completion. |
| `choices` | `array[Choice]` | A list of chat completion choices. Can be more than one if `n` is greater than 1. |
| `usage` | `object` | Usage statistics for the completion request. |
| `session_id` | `string` | The session ID associated with this chat completion, if applicable. |

### Choice Object

| Field | Type | Description |
|-------|------|-------------|
| `index` | `integer` | The index of the choice in the list of choices. |
| `message` | `object` | A chat completion message generated by the model. |
| `finish_reason` | `string` | The reason the model stopped generating tokens: `stop`, `length`, `tool_calls`, `content_filter`, or `function_call`. |
| `logprobs` | `object` | Log probability information for the choice, if requested. |

### Response Message Object

| Field | Type | Description |
|-------|------|-------------|
| `role` | `"assistant"` | The role of the author of this message. |
| `content` | `string` | The contents of the message. |
| `refusal` | `string` | The refusal message generated by the model, if applicable. |
| `annotations` | `array[Annotation]` | Annotations for the message, such as URL citations when using web search. |
| `audio` | `object` | Audio response data, if audio output was requested. |
| `tool_calls` | `array[ToolCall]` | The tool calls generated by the model, such as function calls. |
| `function_call` | `object` | **Deprecated.** Replaced by `tool_calls`. |

### Usage Object

| Field | Type | Description |
|-------|------|-------------|
| `prompt_tokens` | `integer` | Number of tokens in the prompt. |
| `completion_tokens` | `integer` | Number of tokens in the generated completion. |
| `total_tokens` | `integer` | Total number of tokens used in the request (prompt + completion). |

## Headers

### Request Headers

The following headers can be included in your requests to the Sequrity Control API:

#### Authentication

| Header | Description |
|--------|-------------|
| `Authorization` | Bearer token authentication. Format: `Bearer <your-token>`. Used for authenticating requests with JWT tokens. |
| `X-Api-Key` | API key authentication. Alternative to Bearer token authentication for simpler integrations. |

#### Security Configuration

| Header | Description |
|--------|-------------|
| `X-Security-Features` | Enable or disable specific security features for this request. Allows fine-grained control over which security checks are applied. See [Security Features](./headers/security_features.md) for detailed configuration options. |
| `X-Security-Policy` | Specify security policies using SQRT, SQRT-Lite, or Cedar policy languages. Policies define rules for content filtering, access control, and compliance. See [Security Policy](./headers/security_policy.md) for policy syntax and examples. |
| `X-Security-Config` | Provide a complete security configuration object for this request. Combines features, policies, and additional settings in a single header. See [Security Config](./headers/security_config.md) for the full configuration schema. |

#### Session Management

| Header | Description |
|--------|-------------|
| `X-Session-Id` | Specify a session ID to associate this request with an existing session. Useful for maintaining conversation context and applying session-level security policies. |

### Response Headers

| Header | Description |
|--------|-------------|
| `X-Session-Id` | The session ID associated with this response. This will be returned if a session was created or used for the request. Use this value in subsequent requests to maintain session continuity. |

## Example

### Request

```bash
curl -X POST https://api.sequrity.ai/control/v1/chat/completions \
    -H "Authorization: Bearer your-sequrity-api-key" \
    -H "Content-Type: application/json" \
    -H "X-Api-Key: sk-your-openrouter-key" \
    -H 'X-Security-Policy: {"language":"sqrt-lite","codes":""}' \
    -H 'X-Security-Features: [{"feature_name":"Dual LLM","config_json":"{\"mode\":\"standard\"}"},{"feature_name":"Long Program Support","config_json":"{\"mode\":\"base\"}"}]' \
    -d '{
    "model": "openai/gpt-5-mini",
    "messages": [{"role": "user", "content": "What is the largest prime number below 100?"}]
    }'
```

### Response

```json
{
    "id": "df728048-f72c-11f0-b1e5-0f87f79310f1",
    "choices": [
        {
        "finish_reason": "stop",
        "index": 0,
        "message": {
            "content": "{\"status\": \"success\", \"final_return_value\": {\"value\": 97, \"meta\": {\"tags\": [], \"consumers\": [\"*\"], \"producers\": []}}}",
            "role": "assistant"
        }
        }
    ],
    "created": 1769043264,
    "model": "openai/gpt-5-mini,openai/gpt-5-mini",
    "object": "chat.completion",
    "usage": {
        "completion_tokens": 312,
        "prompt_tokens": 2889,
        "total_tokens": 3201
    }
}
```
